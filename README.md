# Organization Directory API

REST API сервис для ведения справочника организаций, зданий и деятельности.
Реализован на современном асинхронном стеке.

## Технологический стек
*   **FastAPI** (Web Framework)
*   **PostgreSQL** (Database)
*   **SQLAlchemy 2.0** (Async ORM)
*   **Docker & Docker Compose**

## Архитектурные решения

### 1. Fully Async I/O
Для взаимодействия с базой данных используется драйвер `asyncpg`. Это обеспечивает полностью неблокирующий I/O, позволяя эффективно утилизировать ресурсы при высоких нагрузках (High Throughput).

### 2. Рекурсия на уровне БД (CTE)
Работа с вложенными категориями ("Еда" -> "Мясная" -> "Говядина") реализована с использованием рекурсивных CTE (Common Table Expressions).
**Преимущество:** Возможность извлечь полное дерево или проверить глубину вложенности за один запрос к БД, исключая проблему N+1 запросов на уровне приложения.

### 3. Гео-поиск (Raw SQL)
Поиск объектов в радиусе и прямоугольной области (Bounding Box) реализован через *Haversine Formula* и тригонометрические функции SQL.
**Обоснование:** Для текущих требований использования тяжеловесного расширения PostGIS является избыточным решением. Реализация на чистом SQL обеспечивает высокую производительность и упрощает развертывание.

## Структура проекта
Приложение спроектировано в соответствии с принципами Clean Architecture:

```
app/
├── api/        # Endpoints и маршрутизация
├── services/   # Бизнес-логика (CTE, гео-вычисления)
├── models/     # ORM модели
├── schemas/    # Pydantic схемы (DTO)
└── db/         # Инициализация и сессии БД
```

## Запуск приложения

```bash
docker-compose up -d --build
```
Документация Swagger UI будет доступна по адресу: [http://localhost:8000/docs](http://localhost:8000/docs)
**API Key:** `secret-static-key-123`

## Тестирование

Реализованы интеграционные тесты с использованием стратегии Transaction Rollback (каждый тест выполняется в изолированной транзакции с последующим откатом).

**Запуск тестов:**
```bash
docker-compose exec app env PYTHONPATH=. pytest -v tests/
```
